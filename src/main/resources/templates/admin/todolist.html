    <!DOCTYPE html>
    <html lang="en">

    <head th:replace="~{/admin/_fragments:: head(~{::title})}">

        <!--<head>-->
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>todo</title>
        <link rel="stylesheet" href="../../static/semantics-dist/semantic.min.css" th:href="@{/semantics-dist/semantic.min.css}">
        <link rel="stylesheet" href="../../static/css/me.css" th:href="@{/css/me.css}">

        <script src="../../static/js/jquery-3.7.1.min.js" th:src="@{/js/jquery-3.7.1.min.js}" ></script>
        <script src="../../static/semantics-dist/semantic.min.js" th:src="@{/semantics-dist/semantic.min.js}" ></script>

    </head>
    <script src="https://cdn.staticfile.org/vue/2.7.0/vue.min.js"></script>

    <body>
    <nav th:replace="admin/_fragments :: menu(2)" class = "ui inverted attached segment m-padded-tb-mini m-shadow-small">
        <div class="ui container"  >
            <div class="ui inverted secondary stackable menu">
                <h3 class="ui teal header item">博客管理后台</h3>
                <a class="active m-mobile-hidden item"> <i class="ui home icon">  </i>发布</a>
                <a class="m-item m-mobile-hidden item"> <i class="ui idea icon">  </i>分类</a>
                <a class="m-item m-mobile-hidden item"><i class="ui tags icon">  </i>标签</a>
                <div class="right m-mobile-hidden menu">
                    <div class="ui dropdown item">
                        <img class="ui avatar image" src="../../static/images/mio3.jpg" alt="mio图">
                        长野原美绪
                        <i class="dropdown icon"></i>
                        <div class="menu">
                            <a href="#" class="item">管理账号</a>
                            <a href="#" class="item">退出登录</a>
                        </div>
                    </div>

                </div>
            </div>

        </div>
        <a href="#" class="ui menu toggle m-mobile-show black button">
            <i class="sidebar icon m-top-right "></i>
        </a>
    </nav>

    <br>
    <br>
    <br>

    <div class="ui   container">

        <div class="ui two stackable grid">
            <div class="six wide column   "   id = "todolistcolumns">
                <div class="ui segment">
                    <div class="ui container" style="height: 30px">
                        <h2 class="ui middle aligned header">想要在这里进行切换</h2>
                    </div>
                    <div class="ui action fluid input">
                        <input type="text" id="Todotitleinput" placeholder="添加任务...">
                        <button class="ui icon button" id="addTodoButton">
                            <i class="plus icon"></i>
                        </button>
                    </div>
                </div>
            <div class="ui m-padded-mini segment " th:fragment="todolists" id ="alltodolist" >


                    <div class="ui divided relaxed list"  >
                        <div class="ui  m-padded-tb-small m-margin-tb-small segment" th:each="todo, stat : ${todolist}"  >


                                <!-- 使用input type="text"来创建一个输入框，并绑定todo对象的title属性 -->
                                <div class="ui labeled floating animated m-padded-tb-mini  fluid input" >
                                    <input type="hidden" th:value="${todo.id}"   />
                                    <div class="ui mini button" onclick="editTodo(this)" style="width:2em" th:attr="data-content=${todo.content}, data-title=${todo.title}, data-todo-id=${todo.id}, data-finished =  ${todo.finished}" >
                                        编辑
                                    </div>
                                    <input type="text" th:value="${todo.title}"     class="ui fluid input"   readonly   />


                                    <div class="ui blue icon todos-complete-button   button"  data-todo-finish-id=${todo.id},>

                                        <i class=" check circle  icon"></i> 完成
                                    </div>
                                    <button class="ui red icon button" onclick="deleteTodo(this)" th:attr="data-id=${todo.id}"  th:id="'completeIcon' + ${todo.id}" >
                                        <i class="trash alternate outline icon"></i>
                                    </button>
                                </div>

                        </div>

                    </div>
                    <!-- 已完成列表 -->

                <div class="ui dropdown item">
                    已完成
                    <i class=" right aligned dropdown icon"></i>
                    <div class="menu">
                        <div class="ui segment">

                            <input type="checkbox" name="todo" value=" "> <label>下班后去拿快递</label>
                        </div>
                    </div>
                </div>
                </div>





            </div>
            <div class="ten wide column">
    <!--  -->
                <form id="todolist-form" action="/admin/todolist" method="post" class="ui form">
                    <div class="ui segment" style="min-height: 300px;">
                        <div class="ui segment">
                            <!-- 去掉了 th:checked 属性，使用普通的 checked 属性 -->
                            <input type="hidden"   id="currenttodoid"  />
                            <input type="checkbox" name="todo"   th:checked="${  currentTodoitem.finished }" id="currenttodofinished" >
                            <input type="text"  th:value="${ currentTodoitem.title }"  id="currenttodotitle" class="ui fluid input" />
                        </div>
                        <div class="ui input fluid">
                            <!-- 去掉了 th:text 属性，直接使用 value 属性 -->
                            <textarea id="currenttodocontent" style="height: 50vh; width: 100%; box-sizing: border-box;" placeholder="todo内容..."></textarea>
                        </div>
                        <div class="item">
                            <button type="submit" class="ui blue button">保存</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <br>
    <br>
    <br>
    <br>


    <footer th:replace="admin/_fragments :: footer" class="ui inverted vertical segment m-padded-tb-massive  ">


        <div class="ui center aligned container">
            <div class="ui inverted divided stackable grid">

                <div class="three wide column">

                    <div class="middle aligned">

                        <img src="../../static/images/mio1.png"
                             class="ui middle aligned round image" alt="" style="width: 150px">
                    </div>


                </div>
                <div class="three wide column ">
                    <h4 class ="ui inverted header" >最新博客</h4>
                    <div class="ui inverted link list">
                        <a href="#" class="item">等待填充1</a>
                        <a href="#" class="item">等待填充2</a>
                        <a href="#" class="item">等待填充3</a>
                    </div>
                </div>
                <div class="three wide column">
                    <h4 class ="ui inverted header">github</h4>
                    <div class="ui inverted link list">
                        <a href="#" class="item">yonghuname@github.com</a>
                        <a href="#" class="item">等待填充</a>
                        <a href="#" class="item">等待填充</a>
                    </div>
                </div>

                <div class="seven wide column">

                    <h4 class ="ui inverted header">博客介绍</h4>

                    <p  class="m-text-thin m-text-spaced m-opacity-mini ">这是我的个人博客,会分享文章，也可能被拿来做todolist</p>

                </div>
            </div>

            <!--111111111111111111111111111111-->

            <div class="ui inverted section divider m-padded-tb-">
            </div> <p class="m-text-thin m-text-spaced m-opacity-mini">All rights reserved  </p>
        </div>
    </footer>


    </body>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!-- JavaScript 代码 -->
    <script>
        // 假设 currentTodoitem 是从后端获取的数据


        // 现在 currentTodoitem 有了默认值，可以安全地使用它
        // 例如，您可以在模板中使用 Thymeleaf 表达式来显示这些值
        // <span th:text="${currentTodoitem.title}"></span>

            // 获取输入框和按钮元素
            var todoTitleInput = document.getElementById('Todotitleinput');
            var addTodoButton = document.getElementById('addTodoButton');

            // 为添加按钮添加点击事件监听器
            addTodoButton.addEventListener('click', function() {
                // 获取输入框的值
                var todoTitle = todoTitleInput.value.trim();

                // 验证输入是否为空
                if (todoTitle === '') {
                    alert('请输入待办事项的标题');
                    return;
                }

                // 构建待办事项对象
                var newTodo = {
                    title: todoTitle,
                    finished:false
                    // 如果有其他属性，可以在这里添加
                };

                // 使用 Axios 发送 POST 请求到后端
                axios.post('todolist/add', newTodo)
                    .then(function(response) {
                        // 请求成功后的回调函数
                        // alert('待办事项添加成功');
                        // 清空输入框
                        todoTitleInput.value = '';
                        currentTodoitem = newTodo;
                        // var todoListHtml = response.data;
                        // document.body.innerHTML = todoListHtml;
                        var todoListContainer = document.getElementById('alltodolist');
                        todoListContainer.innerHTML = response.data;
                        // var todoListContainer = document.get('todolistcolumns');

                        // 清空当前的待办事项列表容器
                        // todoListContainer.innerHTML = '';

                        // console.log("todoListHtml");
                        //
                        // // 将新的待办事项列表插入到容器中
                        // todoListContainer.innerHTML = todoListHtml;
                        // 这里可以添加代码来更新页面上的待办事项列表
                    //     todo 思考一逻辑，这里是不是可以不刷新整个页面呢 也许还有冲突的可能性，不过新增的时候
                    })
                    .catch(function(error) {
                        // 请求失败后的回调函数
                        alert('待办事项添加失败');
                        alert(error)
                        console.error('Error:', error);
                    });

            });
            todoTitleInput.addEventListener('keypress', function(event) {
                // 检查是否按下了回车键（KeyCode: 13）
                if (event.keyCode === 13) {
                    // 阻止默认的回车键行为（例如提交表单）
                    event.preventDefault();

                    // 这里调用点击按钮时的方法
                    addTodoButton.click();
                }
            });

            var completeButtons = document.querySelectorAll('.todos-complete-button.button');

            // 为每个完成按钮添加点击事件监听器
            completeButtons.forEach(function(button) {
                button.addEventListener('click', function() {
                    // 获取待办事项的ID
                    var todoId = button.getAttribute('data-todo-finish-id');
                    // 弹出alert
                    alert("您点击了待办事项完成按钮，待办事项ID为: " + todoId);

                    // 这里可以添加发送更新请求到后端的代码
                    // 例如: axios.put('/admin/todolist/' + todoId, { finished: true })
                    //     .then(function(response) { ... })
                    //     .catch(function(error) { ... });
                });
            });


        document.getElementById('todolist-form').onsubmit = function(event) {
            event.preventDefault(); // 阻止表单的默认提交行为

            // 获取表单数据
            var content = document.getElementById('currenttodocontent').value;
            var finished = document.getElementById('currenttodofinished').value;
            var title = document.getElementById('currenttodotitle').value
            var id =     document.getElementById('currenttodoid').value
            // 构建待办事项对象
            var newTodo = {
                id:id,
                title: title, // 假设标题是固定的
                content: content,
                finished: finished
            };

            // 使用 Axios 发送 POST 请求到后端
            axios.post('/admin/todolist', newTodo)
                .then(function(response) {
                    // 请求成功后的回调函数


                    alert("更新成功");
                    // 这里可以进行页面跳转或者更新页面内容
                })
                .catch(function(error) {
                    // 请求失败后的回调函数
                    alert("更新失败");
                    console.error('Error:', error);
                });
        };
        function deleteTodo(button) {


            // 获取最近的兄弟隐藏 input 元素
            var todoid = button.getAttribute('data-id');

            var res = confirm("确定要删除这个待办事项吗？");
            if(res){

                // 发送 AJAX 请求到后端以删除待办事项
                axios.delete('/admin/todolist',
                    {
                        params:{
                            todoid:todoid
                        }
                    }
                )
                    .then(function(response) {
                        // 删除成功后的回调函数

                        // 从 DOM 中移除待办事项元素
                        var todoItem = button.closest('div.ui.segment'); // 获取整个待办事项元素
                        todoItem.remove();
                    })
                    .catch(function(error) {
                        // 请求失败后的回调函数
                        alert("删除失败");

                        console.error('Error:', error);
                    });
            }
        }

        // 检查 currentTodoitem 是否为 null 或者缺少标题和内容
        if (!currentTodoitem  ) {
            //  currentTodoitem  置默认值
            currentTodoitem = {
                title: "输入标题",
                content: "输入内容",
                finished: false
            };
        }





        function editTodo(button) {


            // 获取待办事项的ID 还有  是 内容和完成状态
            var todoId = button.getAttribute('data-todo-id');
            var todoContent = button.getAttribute('data-content');
                var todoFinished = button.getAttribute('data-finished')  ;
            var todoTitle = button.getAttribute("data-title");

            document.getElementById('currenttodotitle').value =   todoTitle
            document.getElementById('currenttodoid').value =   todoId
            document.getElementById('currenttodofinished').value =   todoFinished
            document.getElementById('currenttodocontent').value =  todoContent

        }


    </script>
    </html>